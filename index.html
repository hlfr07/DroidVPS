<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>UserLAnd Terminal Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background: #111;
            color: #eee;
        }

        #login,
        #terminal {
            margin-bottom: 10px;
        }

        input,
        button {
            padding: 8px;
            margin: 4px;
        }

        iframe {
            width: 100%;
            height: 90vh;
            border: none;
            background: black;
        }
    </style>
</head>

<body>

    <div id="login">
        <h3>Login</h3>
        <input id="user" placeholder="Username" />
        <input id="pass" type="password" placeholder="Password" />
        <button onclick="login()">Login</button>
        <span id="status"></span>
    </div>

    <div id="terminal" style="display:none;">
        <button onclick="openTerminal()">Abrir Terminal</button>
        <iframe id="term"></iframe>
    </div>

    <script>
        const API = "http://192.168.100.196:3001";

        async function login() {
            const username = document.getElementById('user').value;
            const password = document.getElementById('pass').value;
            const status = document.getElementById('status');

            status.textContent = 'Conectando...';

            try {
                const res = await fetch(API + '/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (!res.ok) throw new Error('Login inv√°lido');

                const data = await res.json();
                sessionStorage.setItem('token', data.token);

                status.textContent = 'OK';
                document.getElementById('terminal').style.display = 'block';
            } catch (e) {
                status.textContent = 'Error de login';
            }
        }

        async function openTerminal() {
            const token = sessionStorage.getItem('token');

            const res = await fetch(API + '/api/terminal/url', {
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });

            const data = await res.json();
            document.getElementById('term').src = data.url;
        }
    </script>

</body>

</html>